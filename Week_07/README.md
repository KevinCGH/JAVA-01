# ğŸƒWeek07ä½œä¸šé¢˜ç›®ï¼š

## 2æœˆ24æ—¥è¯¾ç¨‹

### 1.ï¼ˆé€‰åšï¼‰ç”¨ä»Šå¤©è¯¾ä¸Šå­¦ä¹ çš„çŸ¥è¯†ï¼Œåˆ†æè‡ªå·±ç³»ç»Ÿçš„ SQL å’Œè¡¨ç»“æ„

### 2.ï¼ˆå¿…åšï¼‰æŒ‰è‡ªå·±è®¾è®¡çš„è¡¨ç»“æ„ï¼Œæ’å…¥100ä¸‡è®¢å•æ¨¡æ‹Ÿæ•°æ®ï¼Œæµ‹è¯•ä¸åŒæ–¹å¼çš„æ’å…¥æ•ˆç‡ã€‚
[æ•°æ®æ’å…¥å®éªŒ](./data_insert/README.md)

### 3.ï¼ˆé€‰åšï¼‰æŒ‰è‡ªå·±è®¾è®¡çš„è¡¨ç»“æ„ï¼Œæ’å…¥1000ä¸‡è®¢å•æ¨¡æ‹Ÿæ•°æ®ï¼Œæµ‹è¯•ä¸åŒæ–¹å¼çš„æ’å…¥æ•ˆç‡ã€‚
[æ•°æ®æ’å…¥å®éªŒ](./data_insert/README.md)

### 4.ï¼ˆé€‰åšï¼‰ä½¿ç”¨ä¸åŒçš„ç´¢å¼•æˆ–ç»„åˆï¼Œæµ‹è¯•ä¸åŒæ–¹å¼æŸ¥è¯¢æ•ˆç‡ã€‚

### 5.ï¼ˆé€‰åšï¼‰è°ƒæ•´æµ‹è¯•æ•°æ®ï¼Œä½¿å¾—æ•°æ®å°½é‡å‡åŒ€ï¼Œæ¨¡æ‹Ÿ1å¹´æ—¶é—´å†…çš„äº¤æ˜“ï¼Œè®¡ç®—ä¸€å¹´çš„é”€å”®æŠ¥è¡¨ï¼šé”€å”®æ€»é¢ï¼Œè®¢å•æ•°ï¼Œå®¢å•ä»·ï¼Œæ¯æœˆé”€å”®é‡ï¼Œå‰åçš„å•†å“ç­‰ç­‰ï¼ˆå¯ä»¥è‡ªå·±è®¾è®¡æ›´å¤šæŒ‡æ ‡ï¼‰ã€‚

### 6.ï¼ˆé€‰åšï¼‰å°è¯•è‡ªå·±åšä¸€ä¸ª ID ç”Ÿæˆå™¨ï¼ˆå¯ä»¥æ¨¡æ‹Ÿ Seq æˆ– Snowflakeï¼‰ã€‚

### 7.ï¼ˆé€‰åšï¼‰å°è¯•å®ç°æˆ–æ”¹é€ ä¸€ä¸ªéç²¾ç¡®åˆ†é¡µçš„ç¨‹åºã€‚

---
## 3æœˆ2æ—¥è¯¾ç¨‹

### 1.ï¼ˆé€‰åšï¼‰é…ç½®ä¸€éå¼‚æ­¥å¤åˆ¶ï¼ŒåŠåŒæ­¥å¤åˆ¶ã€ç»„å¤åˆ¶ã€‚ 
#### å¼‚æ­¥å¤åˆ¶
[docker-compose.yml](./docker-compose.yml)
     
é…ç½®Master Nodeï¼š

`docker exec -it master_node /bin/bash`

```bash
mysql> CREATE USER 'repl'@'%' IDENTIFIED BY '123456';
Query OK, 0 rows affected (0.11 sec)

mysql> GRANT REPLICATION SLAVE ON *.* TO 'repl'@'%';
Query OK, 0 rows affected (0.12 sec)

mysql> flush privileges;
Query OK, 0 rows affected (0.10 sec)

mysql> show master status;
+------------------+----------+--------------+------------------+-------------------+
| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+------------------+----------+--------------+------------------+-------------------+
| mysql-bin.000004 |      747 |              |                  |                   |
+------------------+----------+--------------+------------------+-------------------+
1 row in set (0.00 sec)
```

è®¾ç½®Slave Nodeï¼š

```bash
CHANGE MASTER TO
    MASTER_HOST='master_node',  
    MASTER_PORT=3316,
    MASTER_USER='repl',      
    MASTER_PASSWORD='123456',   
    MASTER_LOG_FILE='mysql-bin.000004',
    MASTER_LOG_POS=747;
```
#### åŠåŒæ­¥å¤åˆ¶
#### ç»„å¤åˆ¶


### 2.ï¼ˆå¿…åšï¼‰è¯»å†™åˆ†ç¦»-åŠ¨æ€åˆ‡æ¢æ•°æ®æºç‰ˆæœ¬1.0
[DynamicDataSourceApplication](./dynamic-data-source/src/main/java/com/example/dynamicdatasource/DynamicDataSourceApplication.java)

é…ç½®æ•°æ®æº`master`ã€`slave1`ã€`slave2`ï¼Œå…¶ä¸­`master`å’Œ`slave1`ç»„æˆå¼‚æ­¥ä¸»ä»å¤åˆ¶ï¼Œ`slave2`ä¸ºä¸ç›¸å…³çš„ä¸€ä¸ªæ•°æ®åº“ï¼ˆä¿æŒæœ‰åŒæ ·çš„è¡¨ï¼Œä½†æ— æ•°æ®ï¼‰

æŸ¥è¯¢è¿‡æ•°æ®æ—¶ä¼šåœ¨`slave1`å’Œ`slave2`ä¹‹é—´åˆ‡æ¢ï¼ˆå½“åˆ‡æ¢åˆ°`slave2`æ—¶æŸ¥æ— æ•°æ®ï¼‰ï¼Œæ’å…¥æ•°æ®æ—¶ä¼šä½¿ç”¨`master`


### 3.ï¼ˆå¿…åšï¼‰è¯»å†™åˆ†ç¦»-æ•°æ®åº“æ¡†æ¶ç‰ˆæœ¬2.0
> ä½¿ç”¨ ShardingSphere-jdbc 5.0.0-alpha å®ç°è¯»å†™åˆ†ç¦»é…ç½®

é…ç½®é¢˜ç›®2çš„ä¸¤ä¸ªä¸»ä»æ•°æ®åº“ [config-replica-query.yaml](./config-replica-query.yaml)
```bash
# å¯åŠ¨ ShardingSphere
./bin/start.sh
```

### 4.ï¼ˆé€‰åšï¼‰è¯»å†™åˆ†ç¦»-æ•°æ®åº“ä¸­é—´ä»¶ç‰ˆæœ¬3.0


### 5.ï¼ˆé€‰åšï¼‰é…ç½® MHAï¼Œæ¨¡æ‹Ÿ master å®•æœº

### 6.ï¼ˆé€‰åšï¼‰é…ç½® MGRï¼Œæ¨¡æ‹Ÿ master å®•æœº


### 7.ï¼ˆé€‰åšï¼‰é…ç½® Orchestratorï¼Œæ¨¡æ‹Ÿ master å®•æœºï¼Œæ¼”ç»ƒ UI è°ƒæ•´æ‹“æ‰‘ç»“æ„